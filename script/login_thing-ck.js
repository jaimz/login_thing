// Generated by LiveScript 1.2.0
(function(){function u(e,t,n){return function(){return(n||e)[t].apply(e,arguments)}}var e,t,n,r,i,s,o;e="primary";t=700;n=Bacon;r=function(e){var t,r;t=function(){return e.value};r=n.fromEventTarget(e,"change");return n.fromEventTarget(e,"keyup").debounceImmediate(500).merge(r).map(t).toProperty(t())};i=function(e,t,n){return n===!1?e.removeAttribute(t):e.setAttribute(t,n)};s=function(){function s(n){var s,o,a,f,l=this;this.RootView=n!=null?n:document.getElementById(e);this.doLogout=u(this,"doLogout",t);this.didGetInfo=u(this,"didGetInfo",t);this.didLogin=u(this,"didLogin",t);this.startLogin=u(this,"startLogin",t);this.showAvatar=u(this,"showAvatar",t);this.lookupAvatar=u(this,"lookupAvatar",t);if(this.RootView==null){console.error("Was not supplied with user card (and could not find "+e);return}this.usernameIpt=this.RootView.querySelector("input[name=username]");this.passwordIpt=this.RootView.querySelector("input[name=password]");this.doLoginButton=this.RootView.querySelector("button[name=submit-login]");this.doLogoutButton=this.RootView.querySelector("button[name=sign-out]");this.avatarCoin=this.RootView.querySelector(".avatar");this.loginDialog=this.RootView.querySelector(".login.dialog");this.avatarCoin.addEventListener("click",function(e){l.RootView.classList.toggle("will-login")});this._username=r(this.usernameIpt);this._password=r(this.passwordIpt);s=function(e){return e.length>0};this._lookingUpAvatar=!1;this._avatarLookupTimer=null;this._haveAvatar=!1;this._username.onValue(this.lookupAvatar);o=this._username.map(s);a=this._password.map(s);f=o.and(a);f.onValue(function(e){i(l.doLoginButton,"disabled",!e)});this.loginDialog!=null&&this.loginDialog.addEventListener("submit",this.startLogin);this.doLogoutButton!=null&&this.doLogoutButton.addEventListener("click",this.doLogout)}s.displayName="UserCard";var t=s.prototype,n=s;t.lookupAvatar=function(e){this._avatarLookupTimer!=null&&clearTimeout(this._lookingUpAvatar);if(e.length>0&&this._haveAvatar===!1){this.avatarCoin.classList.add("searching");this._avatarLookupTimer=setTimeout(this.showAvatar,1e3)}};t.showAvatar=function(){this.avatarCoin.classList.remove("searching");this.avatarCoin.classList.add("with-image");this._haveAvatar=!0};t.startLogin=function(e){this.RootView.classList.add("will-login");setTimeout(this.didLogin,3e3);return!1};t.didLogin=function(){this.usernameIpt.value="";this.passwordIpt.value="";this.RootView.classList.remove("will-login");this.RootView.classList.add("did-login");setTimeout(this.didGetInfo,1500)};t.didGetInfo=function(){this.RootView.classList.add("did-get-info")};t.doLogout=function(){this.avatarCoin.classList.remove("with-image");this.RootView.classList.remove("did-login");this.RootView.classList.remove("did-get-info");this._haveAvatar=!1};return s}();o=function(){return window.userCard=new s};document.addEventListener("DOMContentLoaded",o)}).call(this);